<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login - Spending Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <link rel="stylesheet" href="css/style.css?v=19" />
  <link rel="stylesheet" href="css/login.css?v=19" />
</head>
<body>

  <div class="background-container">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <div id="game-area">
    </div>

  <div class="login-container">
    <div class="login-card" id="tilt-card">
      <div class="brand-icon">
        <svg width="28" height="28" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4.5 3.75a3 3 0 00-3 3v.75h21v-.75a3 3 0 00-3-3h-15z" />
          <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 003 3h15a3 3 0 003-3v-7.5zm-18 3.75a.75.75 0 01.75-.75h6a.75.75 0 010 1.5h-6a.75.75 0 01-.75-.75zm.75 2.25a.75.75 0 000 1.5h3a.75.75 0 000-1.5h-3z" clip-rule="evenodd" />
        </svg>
      </div>
      
      <h1>Welcome Back</h1>
      <p class="subtitle">Track your spending with confidence.<br><span style="font-size:0.8rem; opacity:0.8;">(Try throwing the coins!)</span></p>

      <button id="google-login-btn" class="google-btn">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
          <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
          <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/>
          <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/>
          <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/>
        </svg>
        <span>Sign in with Google</span>
      </button>

      <div class="divider">
        <span>Secure Login</span>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
  <script src="js/firebase-init.js"></script>
  <script src="js/auth.js"></script>

  <script>
    /* =========================================
       1. 3D HOLOGRAPHIC TILT & SPOTLIGHT
       ========================================= */
    const card = document.getElementById('tilt-card');
    
    document.addEventListener('mousemove', (e) => {
      if (!card) return;
      
      const { innerWidth, innerHeight } = window;
      const x = e.clientX;
      const y = e.clientY;
      
      // Calculate rotation (Sensitivity 25)
      // center of screen is 0,0
      const rotateY = (innerWidth / 2 - x) / 25; 
      const rotateX = (innerHeight / 2 - y) / -25;

      // Apply 3D Rotation
      card.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg)`;

      // Update Spotlight Position (CSS Variables)
      const rect = card.getBoundingClientRect();
      const mouseX = x - rect.left;
      const mouseY = y - rect.top;
      
      card.style.setProperty('--mouse-x', `${mouseX}px`);
      card.style.setProperty('--mouse-y', `${mouseY}px`);
    });


    /* =========================================
       2. ZERO-GRAVITY COIN PHYSICS
       ========================================= */
    const gameArea = document.getElementById('game-area');
    const COIN_COUNT = 8;
    const coins = [];

    // Create Coins
    for (let i = 0; i < COIN_COUNT; i++) {
      createCoin();
    }

    function createCoin() {
      const coin = document.createElement('img');
      coin.src = "https://em-content.zobj.net/source/microsoft-teams/337/coin_1fa99.png";
      coin.classList.add('coin');
      coin.draggable = false; 
      
      // Initial Position
      const x = Math.random() * (window.innerWidth - 80);
      const y = Math.random() * (window.innerHeight - 80);
      
      coin.style.left = x + 'px';
      coin.style.top = y + 'px';
      coin.style.transform = `rotate(${Math.random() * 360}deg)`;

      // Physics State for this coin
      const physics = {
        el: coin,
        x: x,
        y: y,
        vx: (Math.random() - 0.5) * 2, // Random drift velocity
        vy: (Math.random() - 0.5) * 2,
        isDragging: false,
        lastX: 0,
        lastY: 0,
        lastTime: 0
      };
      
      coins.push(physics);
      makeInteractable(physics);
      gameArea.appendChild(coin);
    }

    // Animation Loop (Runs 60fps)
    function animate() {
      const friction = 0.98; // Air resistance
      const bounce = 0.7;    // Bounciness (0 = no bounce, 1 = perfect elastic)
      const maxX = window.innerWidth - 64;
      const maxY = window.innerHeight - 64;

      coins.forEach(p => {
        if (!p.isDragging) {
          // Apply velocity
          p.x += p.vx;
          p.y += p.vy;

          // Apply Friction
          p.vx *= friction;
          p.vy *= friction;

          // Screen Collisions (Bounce)
          if (p.x < 0) { p.x = 0; p.vx *= -bounce; }
          if (p.x > maxX) { p.x = maxX; p.vx *= -bounce; }
          if (p.y < 0) { p.y = 0; p.vy *= -bounce; }
          if (p.y > maxY) { p.y = maxY; p.vy *= -bounce; }

          // Apply Position
          p.el.style.left = p.x + 'px';
          p.el.style.top = p.y + 'px';
        }
      });

      requestAnimationFrame(animate);
    }
    animate(); // Start the physics engine

    // Drag Logic
    function makeInteractable(p) {
      const el = p.el;
      let startX, startY;

      // Mouse Down
      el.addEventListener('mousedown', (e) => {
        p.isDragging = true;
        startX = e.clientX - p.x;
        startY = e.clientY - p.y;
        el.style.zIndex = 1000;
        el.style.cursor = 'grabbing';
        p.vx = 0; p.vy = 0; // Stop movement while holding
        p.lastX = e.clientX;
        p.lastY = e.clientY;
        p.lastTime = Date.now();
      });

      // Mouse Move
      window.addEventListener('mousemove', (e) => {
        if (!p.isDragging) return;
        e.preventDefault();
        
        // Move coin
        p.x = e.clientX - startX;
        p.y = e.clientY - startY;
        el.style.left = p.x + 'px';
        el.style.top = p.y + 'px';

        // Calculate throwing velocity
        const now = Date.now();
        const dt = now - p.lastTime;
        if (dt > 0) {
          p.vx = (e.clientX - p.lastX) / dt * 15; // Speed multiplier
          p.vy = (e.clientY - p.lastY) / dt * 15;
          p.lastX = e.clientX;
          p.lastY = e.clientY;
          p.lastTime = now;
        }
      });

      // Mouse Up
      window.addEventListener('mouseup', () => {
        if (!p.isDragging) return;
        p.isDragging = false;
        el.style.zIndex = 20;
        el.style.cursor = 'grab';
      });
      
      // (Repeat for Touch events if needed, omitted for brevity but logic is same)
    }
  </script>

</body>
</html>
