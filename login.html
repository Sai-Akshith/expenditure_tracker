<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login - Spending Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <link rel="stylesheet" href="css/style.css?v=17" />
  <link rel="stylesheet" href="css/login.css?v=17" />
</head>
<body>

  <div class="background-container">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <div id="game-area">
    <div id="bank-container">
      <img src="https://em-content.zobj.net/source/microsoft-teams/337/piggy-bank_1f437.png" id="piggy-bank" alt="Piggy Bank">
      <div class="bank-label">Feed me savings!</div>
    </div>
  </div>

  <div class="login-container">
    <div class="login-card">
      <div class="brand-icon">
        <svg width="28" height="28" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4.5 3.75a3 3 0 00-3 3v.75h21v-.75a3 3 0 00-3-3h-15z" />
          <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 003 3h15a3 3 0 003-3v-7.5zm-18 3.75a.75.75 0 01.75-.75h6a.75.75 0 010 1.5h-6a.75.75 0 01-.75-.75zm.75 2.25a.75.75 0 000 1.5h3a.75.75 0 000-1.5h-3z" clip-rule="evenodd" />
        </svg>
      </div>
      
      <h1>Welcome Back</h1>
      <p class="subtitle">Drag the coins to the piggy bank!</p>

      <button id="google-login-btn" class="google-btn">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
          <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
          <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/>
          <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/>
          <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/>
        </svg>
        <span>Sign in with Google</span>
      </button>

      <div class="divider">
        <span>Secure Login</span>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
  <script src="js/firebase-init.js"></script>
  <script src="js/auth.js"></script>

  <script>
    const gameArea = document.getElementById('game-area');
    const bankContainer = document.getElementById('bank-container');
    const piggy = document.getElementById('piggy-bank');
    const COIN_COUNT = 6; 

    // 1. Create 3D Coins
    for (let i = 0; i < COIN_COUNT; i++) {
      createCoin();
    }

    function createCoin() {
      const coin = document.createElement('img');
      // RELIABLE SOURCE: Emojipedia Microsoft Teams 3D
      coin.src = "https://em-content.zobj.net/source/microsoft-teams/337/coin_1fa99.png";
      coin.classList.add('coin');
      coin.draggable = false; 
      
      // Random Position
      const x = Math.random() * (window.innerWidth - 80);
      const y = Math.random() * (window.innerHeight - 80);
      
      coin.style.left = x + 'px';
      coin.style.top = y + 'px';
      coin.style.transform = `rotate(${Math.random() * 360}deg)`;

      makeDraggable(coin);
      gameArea.appendChild(coin);
    }

    // 2. Drag Logic
    function makeDraggable(el) {
      let isDragging = false;
      let startX, startY, initialLeft, initialTop;

      // Mouse Events
      el.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        startY = e.clientY;
        initialLeft = el.offsetLeft;
        initialTop = el.offsetTop;
        el.style.zIndex = 1000;
        el.style.cursor = 'grabbing';
        el.style.transition = 'none';
      });

      window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        el.style.left = `${initialLeft + dx}px`;
        el.style.top = `${initialTop + dy}px`;
      });

      window.addEventListener('mouseup', (e) => {
        if (!isDragging) return;
        isDragging = false;
        checkDrop(el);
      });

      // Touch Events (Mobile)
      el.addEventListener('touchstart', (e) => {
        isDragging = true;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        initialLeft = el.offsetLeft;
        initialTop = el.offsetTop;
        el.style.zIndex = 1000;
        el.style.transition = 'none';
      }, { passive: false });

      window.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        const dx = e.touches[0].clientX - startX;
        const dy = e.touches[0].clientY - startY;
        el.style.left = `${initialLeft + dx}px`;
        el.style.top = `${initialTop + dy}px`;
      }, { passive: false });

      window.addEventListener('touchend', (e) => {
        if (!isDragging) return;
        isDragging = false;
        checkDrop(el);
      });
    }

    function checkDrop(coin) {
      coin.style.cursor = 'grab';
      coin.style.zIndex = 100;

      const coinRect = coin.getBoundingClientRect();
      const bankRect = bankContainer.getBoundingClientRect();

      // Check collision
      if (
        coinRect.left < bankRect.right &&
        coinRect.right > bankRect.left &&
        coinRect.top < bankRect.bottom &&
        coinRect.bottom > bankRect.top
      ) {
        dropInBank(coin);
      }
    }

    function dropInBank(coin) {
      // 1. Shrink and fade out coin (as if entering the pig)
      coin.style.transition = 'all 0.3s ease-in';
      coin.style.transform = 'scale(0) rotate(360deg)';
      coin.style.opacity = '0';
      
      // 2. Bounce the Piggy Bank
      piggy.classList.remove('bounce'); // reset
      void piggy.offsetWidth; // trigger reflow
      piggy.classList.add('bounce');

      // 3. Remove coin after animation
      setTimeout(() => {
        coin.remove();
      }, 300);
    }
  </script>

</body>
</html>
